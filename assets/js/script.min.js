window.addEventListener("scroll",()=>{let navbar=document.getElementById("navbar");let menu=document.getElementById("menu");if(window.scrollY===0){navbar.classList.remove("shadow")}else{navbar.classList.add("shadow")}if(menu.classList.contains("show"))menu.classList.remove("show")});window.addEventListener("resize",function(){removeControls("controlsContent");removeControls("controlsQueue");if(!isTouchScreen())document.querySelector("#search").querySelector("input").style.width=""});window.addEventListener("orientationchange",updateSearch);if("orientation"in screen){screen.orientation.addEventListener("change",updateSearch)}window.addEventListener("focus",function(){if(typeof MSAPI!=="undefined"&&MSAPI.paused)playPauseButton("pause")});document.addEventListener("visibilitychange",()=>{setTimeout(function(){if(document.visibilityState==="visible"&&typeof MSAPI!=="undefined"&&MSAPI.paused){playPauseButton("pause")}},200)});document.onkeydown=function(e){let keys=["K","Space","M","ArrowLeft","ArrowRight","J","L","R","S","ArrowUp","ArrowDown"];let key=e.code.replace("Key","");if(!(document.activeElement instanceof HTMLInputElement)){if(keys.includes(key)){e.preventDefault();let player=document.getElementById("player");let timeline=player.querySelector("#timeline");let mouseUpEvent=new Event("mouseup",{bubbles:true,cancelable:true});let clickEvent=new Event("click",{bubbles:true,cancelable:true});switch(key){case"R":let repeatButton=player.querySelector(".repeat");repeatButton.dispatchEvent(clickEvent);break;case"S":let shuffleButton=player.querySelector(".fa-random");shuffleButton.dispatchEvent(clickEvent);break;case"K":case"Space":if(playing)pauseSong();else play();break;case"M":muteAudio();break;case"ArrowLeft":timeline.value=Number(timeline.value)-5;timeline.dispatchEvent(mouseUpEvent);break;case"ArrowRight":timeline.value=Number(timeline.value)+5;timeline.dispatchEvent(mouseUpEvent);break;case"J":timeline.value=Number(timeline.value)-10;timeline.dispatchEvent(mouseUpEvent);break;case"L":timeline.value=Number(timeline.value)+10;timeline.dispatchEvent(mouseUpEvent);break;case"ArrowUp":volume=volume+.1;if(volume>1)volume=1;setVolume(volume);break;case"ArrowDown":volume=volume-.1;if(volume<0)volume=0;setVolume(volume);break}}}};function loadPage(){let content=document.querySelector("#content"),title=document.querySelector("title");let data=htmlToElement(httpGet("./pages/"+page+".html"));dataIncludeReplace(data);content.innerHTML=data.body.innerHTML;let subpage=data.querySelector("title")?data.querySelector("title").textContent:"error";title.textContent=subpage+" - "+title.textContent.split(" - ")[1];if(backgroundProcesses.length){for(let backgroundProcess of backgroundProcesses){clearInterval(backgroundProcess)}backgroundProcesses=[]}if(typeof window[page]==="undefined"){let scripts=data.getElementsByTagName("script");for(let script of scripts){getScript(script.src)}}let i=0;let pageLoad=setInterval(()=>{if(typeof window[page]!=="undefined"){clearInterval(pageLoad);window[page]()}else if(i>3){clearInterval(pageLoad);showNotification("Page not implemented yet.",3e3)}i++},100)}function getScript(source){let script=document.createElement("script");let prior=document.querySelectorAll("body script:last-child")[0];script.async=true;script.src=source;prior.parentNode.insertBefore(script,prior);prior.remove()}function getPage(){let hash=window.location.hash;let match=hash.match("page=[^&]*");if(match)return match[0].split("=")[1];return"home"}bindEvent("click","#navbar [data-page]",function(e){e.preventDefault();let navigation=document.querySelector("#navigation");if(navigation.classList.contains("show"))navigation.classList.remove("show");let queueView=document.querySelector("#queueView");if(queueView.classList.contains("show")){let body=document.getElementsByTagName("body")[0];let angleIcon=document.getElementsByClassName("fa-angle-up")[0];hidePlaylist(body,queueView,angleIcon)}page=e.target.dataset.page;prevPage=undefined;window.location.href="#!page="+page;loadPage();setActiveNavbar()});bindEvent("click","#navbar-toggler",function(){let navigation=document.querySelector("#navigation");if(navigation.classList.contains("show"))navigation.classList.remove("show");else navigation.classList.add("show")});bindEvent("click","#player .fa-pause",()=>pauseSong());bindEvent("click","#player .fa-play",()=>{let timeline=document.getElementById("timeline");if(timeline.max===timeline.value){let nextIndex=nextSongIndex();if(typeof playlist[nextIndex]!=="undefined"){if(typeof playlist[nextIndex]["player"]==="undefined")downloadPart(0,nextIndex,partIndex);playIndex=nextIndex}play(true)}else play()});bindEvent("touchstart","#timeline",()=>onTimelinePress());bindEvent("mousedown","#timeline",()=>onTimelinePress());bindEvent("input","#timeline",e=>onTimelineMove(e));bindEvent("click","[data-title]",function(){if(!isTouchScreen()||touched&&touchedElement===this){let element=this;touched=false;setTimeout(function(){if(currentHover===element){showNotification(element.getAttribute("data-title"),3e3)}},200)}else{touchedElement=this;touched=true}});bindEvent("mouseover","#queueView tr[data-id]",function(){let controls=this.querySelector(".controlsQueue");if(!controls){removeControls("controlsQueue");controls=createControls("controlsQueue",["play"]);let pos=this.getBoundingClientRect();controls.style.top="3px";controls.style.right="0";controls.style.height=pos.height-6+"px";controls.style.lineHeight=pos.height-6+"px";controls.setAttribute("data-id",this.getAttribute("data-id"));setTimeout(()=>{this.querySelector("td:last-of-type").appendChild(controls);controls.classList.add("show")},50)}else clearTimeout(controlsTimeout)});bindEvent("mouseout","#queue",function(){setTimeout(function(){if(currentHover.closest("#queue")===null){removeControls("controlsQueue")}},50)});bindEvent("mouseout","#queueView tr[data-id]",function(){let row=this;controlsTimeout=setTimeout(function(){if(row!==currentHover.closest("tr")){touched=false;let controls=row.querySelector(".controlsQueue");if(controls)controls.remove()}},0)});bindEvent("input","#search input",function(){if(page!=="music")prevPage=getPage();if(this.value||typeof prevPage==="undefined")page="music";else page=prevPage;window.location.href="#!page="+page;loadPage()});bindEvent("keyup","#search",function(e){if(e.keyCode===13){e.preventDefault();let navigation=document.querySelector("#navigation");if(navigation.classList.contains("show"))navigation.classList.remove("show")}});bindEvent("click","#view .fa-list",function(){setCookie("view","list");loadPage()});bindEvent("click","#view .fa-grip-horizontal",function(){setCookie("view","grid");loadPage()});bindEvent("click",".repeat",function(){switch(repeatMode){case 0:repeatMode=1;this.style.color="#1d93ff";break;case 1:repeatMode=2;this.querySelector(".repeatOne").classList.add("show");break;case 2:repeatMode=0;this.style.color="unset";this.querySelector(".repeatOne").classList.remove("show");break}});bindEvent("click",".fa-random",function(){let currentSong=playlist[playIndex];if(currentSong){resetSong(playIndex);delete playlist[playIndex];playlist.splice(playIndex,1);playlist=playlist.sort((a,b)=>.5-Math.random());playlist.unshift(currentSong);playIndex=0;partIndex=0;let queueView=document.getElementById("queueView");let queue=queueView.querySelector("#queue");queue.innerHTML="";queue.appendChild(generateListView(playlist));play()}});bindEvent("mouseover",".volume",function(){document.getElementsByClassName("volumeBackground")[0].classList.add("show");hideVolumeSlider()});bindEvent("mouseout",".volume",function(){document.getElementsByClassName("volumeBackground")[0].classList.remove("show")});bindEvent("input",".volumeSlider",function(){let volumeSlider=this;volume=volumeSlider.value/100;setVolume(volume)});bindEvent("click",".volume svg",function(e){muteAudio(e)});bindEvent("click",".fa-angle-up",function(){let queueView=document.getElementById("queueView");let navbar=document.getElementById("navbar");let body=document.getElementsByTagName("body")[0];if(this.getAttribute("data-angle")==="up"){hidePlaylist(body,queueView,this);if(window.scrollY!==0)navbar.classList.add("shadow")}else{navbar.classList.remove("shadow");body.style.overflowY="hidden";this.animate([{transform:"rotate(0deg)"},{transform:"rotate(-180deg)"}],{duration:200,fill:"forwards"});let queue=queueView.querySelector("#queue");queue.innerHTML="";queue.appendChild(generateQueue(playlist));if(queue.scrollHeight>queue.clientHeight)queue.style.right="-10px";else queue.style.right="0";queueView.animate([{top:"100%"},{top:"60px"}],{duration:300,fill:"forwards"});this.setAttribute("data-angle","up")}removeControls("controlsContent");removeControls("controlsQueue")});bindEvent("click",".theme-toggler",function(){let html=document.getElementsByTagName("html")[0],icon=this.querySelector("svg");if(html.getAttribute("data-theme")==="dark"){html.setAttribute("data-theme","light");icon.classList.remove("fa-sun");icon.classList.add("fa-moon");theme="light";setCookie("theme","light")}else{html.setAttribute("data-theme","dark");icon.classList.remove("fa-moon");icon.classList.add("fa-sun");theme="dark";setCookie("theme","dark")}document.getElementById("menu").classList.remove("show")});bindEvent("click",".search-toggler",function(){showSearch()});bindEvent("click","#menu-toggler",function(){let menu=this.parentNode.querySelector("#menu");if(menu.classList.contains("show")){menu.classList.remove("show")}else{let interval=setInterval(function(){menu.classList.add("show");if(menu.classList.contains("show"))clearInterval(interval)},50)}});bindEvent("mouseout","#menu",function(){let menu=this;setTimeout(function(){if(currentHover.closest("#menu")!==menu)menu.classList.remove("show")})});bindEvent("focusout","#search",function(){if(getWidth()<=1150){let input=this.querySelector("input");input.style.width=""}});bindEvent("click","#queueInfo .queue:not(.active)",function(){let queueInfo=document.getElementById("queueInfo");queueInfo.querySelector("#info").style.display="none";queueInfo.querySelector("#queue").style.display="block";queueInfo.querySelector(".info").classList.remove("active");this.classList.add("active")});bindEvent("click","#queueInfo .info:not(.active)",function(){let queueInfo=document.getElementById("queueInfo");queueInfo.querySelector("#queue").style.display="none";queueInfo.querySelector("#info").style.display="block";queueInfo.querySelector(".queue").classList.remove("active");this.classList.add("active")});document.addEventListener("DOMContentLoaded",function(){let iconInterval=setInterval(function(){let togglers=document.getElementsByClassName("theme-toggler");if(togglers){for(let toggler of togglers){let icon=toggler.querySelector("svg");if(icon){if(theme==="light")icon.classList.add("fa-moon");else icon.classList.add("fa-sun");clearInterval(iconInterval)}}}},50);page=getPage();window.location.href="#!page="+page;loadPage();dataIncludeReplace(document.body);setActiveNavbar();navigator.serviceWorker.getRegistrations().then(function(registrations){for(let registration of registrations){registration.unregister()}})});